{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
<!-- Container-fluid starts-->
<div class="container-fluid">
    <div class="page-header">
        <div class="row">
            <div class="col-lg-6">
                <div class="page-header-left">
                    <h3>Service Details

                    </h3>
                </div>
            </div>
            <div class="col-lg-6">
                <ol class="breadcrumb float-right">
                    <li class="breadcrumb-item"><a href="{% url 'common:home' %}"><i data-feather="home"></i></a></li>
                    <li class="breadcrumb-item">Services</li>
                    <li class="breadcrumb-item active">Service Details</li>
                </ol>
            </div>
        </div>
    </div>
</div>
<!-- Container-fluid Ends-->
 

<!-- Container-fluid starts-->
<div class="container-fluid">
    <div class="card">
        <div class="row product-page-main card-body">
            <div class="col-md-3">

                <div class="col-auto">
                    <div class="avatar-wrapper" data-tippy-placement="bottom" title="Service image">
                        {% if servicerecord.picture %}
                        <img alt="" class="profile-pic" src="{{servicerecord.picture.url}}" />
                        {% endif %}
                    </div>
                </div>

            </div>
            <div class="col-md-9">
                <div class="product-page-details product-right mb-0">
                    <h2>{{servicerecord.service_name}}</h2>
                    <hr>
                    <h3 class="product-title">Service Details</h3>

                    <b>Service Provider Name</b>: {{servicerecord.user.profile}} <br>
                    <b>Email</b>: {{servicerecord.user.email}} <br>
                    <b>Phone</b>:
                    {{providerrecord.phone_1}}{% if providerrecord.phone_2 %}/{{providerrecord.phone_2}}{% endif %} <br>
                    <b>Service Name</b>: {{servicerecord.service_name}} <br>
                    <b>Service Location</b>: {{servicerecord.compute_location}}<br>

                    <b>Category</b>: {{servicerecord.category}} <br>
                    <b>Availability Date</b>: {{servicerecord.availability_date}} <br>
                    <h3 class="product-title">Address</h3>
                    
                   

                    <div class="m-t-15">
                        <button class="btn btn-primary m-r-10" id="approve_btn" type="button">Approve</button>
                        <button class="btn btn-decline" id="decline_btn" type="button">Decline</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Container-fluid Ends-->

{% endblock %}
{% block javascript %}
<script>

    var $approve = $('#approve_btn')
    var $decline = $('#decline_btn')



    ///used cookies to get crsf token
    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }

    function initTable() {

        ///approve farmer profiles
        $approve.click(function () {

            $approve.prop('disabled', true)

            swal({
                title: "Approve Services?",
                text: "Are you sure you want to approve services",
                icon: "success",
                buttons: true,
                dangerMode: false,
            })
                .then((willDelete) => {
                    if (willDelete) {

                        $.ajax({
                            url: "/openmarket/" + {{ profilerecord.user.id }} +'/approve/',
                                data: { },
                    headers: { "X-CSRFToken": getCookie("csrftoken") },
                    type: 'PATCH',
                        //contentType: 'application/json',
                        success: function(result) {
                            console.log('approved successfully');
                        },
                });
            swal("You have approve service/s successfully!", {
                icon: "success",
            });
        } else {
            swal("You have cancelled service approvals!");
        }
});

    })


    ///decline farmer request
    $decline.click(function () {

        $decline.prop('disabled', true)

        swal({
            title: "Decline Application",
            text: "Are you sure You want to decline these Applications?",
            icon: "warning",
            buttons: true,
            dangerMode: false,
        })
            .then((willDelete) => {
                if (willDelete) {

                    $.ajax({
                        url: "/openmarket/" + {{ profilerecord.user.id }} +'/approve/',
                            data: { },
                headers: { "X-CSRFToken": getCookie("csrftoken") },
                type: 'PUT',
                    //contentType: 'application/json',
                    success: function(result) {
                        console.log(' Service Provider /s approved successfully');
                    },
            });
        swal("You have Declined Services successfully!", {
            icon: "success",
        });
    } else {
        swal("You have cancelled Service approvals!");
    }
});

    })

  }

    $(function () {
        initTable()

    })


</script>
{% endblock %}